
$ minikube start --memory=4096 --cpus 4 --driver=docker
$ minikube dashboard
$ kubectl label namespace default istio-injection=enabled
$ istioctl install --set profile=demo -y
$ kubectl apply -f istio_addons
$ kubectl rollout status deployment/kiali -n istio-system
$ istioctl dashboard kiali

$ kubectl apply -f rabbitmq.yaml
$ kubectl apply -f order.yaml
$ kubectl apply -f shipping.yaml

$ kubectl logs -f $(kubectl get pods -l app=shipping -o jsonpath="{.items[0].metadata.name}")
$ kubectl logs -f $(kubectl get pods -l app=order,version=v1 -o jsonpath="{.items[0].metadata.name}")
$ kubectl logs -f $(kubectl get pods -l app=order,version=v2 -o jsonpath="{.items[0].metadata.name}")

$ kubectl port-forward svc/order 3000
$ kubectl apply -f order-gateway.yaml
$ kubectl apply -f destination-rule-all.yaml

$ kubectl get virtualservice

$ minikube tunnel
$ ./test-loop.sh

$ kubectl apply -f virtual-service-all-v1.yaml
$ kubectl apply -f virtual-service-90-10.yaml
$ kubectl apply -f virtual-service-all-v2.yaml

$ kubectl delete -f rabbitmq.yaml
$ kubectl delete -f order.yaml
$ kubectl delete -f shipping.yaml
$ kubectl delete -f order-gateway.yaml
$ kubectl delete -f destination-rule-all.yaml
$ kubectl delete -f istio_addons

$ istioctl uninstall --purge
$ kubectl delete ns istio-system


$ echo hello >> /proc/1/fd/1
$ tail -f /proc/1/fd/1
